<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·ªù Vua - Ng∆∞·ªùi V·ªõi Ng∆∞·ªùi</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Auth Panel (Login/Register) -->
        <div class="auth-panel" id="authPanel">
            <div class="auth-header">
                <h1>üéÆ C·ªù Vua</h1>
                <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi tr√≤ ch∆°i</p>
            </div>

            <!-- Login Form -->
            <div class="auth-form" id="loginForm">
                <h2>ƒêƒÉng Nh·∫≠p</h2>
                <div class="form-group">
                    <label>üë§ T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="loginUsername" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p...">
                </div>
                <div class="form-group">
                    <label>üîí M·∫≠t kh·∫©u</label>
                    <input type="password" id="loginPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
                </div>
                <button class="btn-primary" onclick="handleLogin()">ƒêƒÉng Nh·∫≠p</button>
                <p class="auth-switch">
                    Ch∆∞a c√≥ t√†i kho·∫£n? 
                    <a href="#" onclick="showRegister(); return false;">ƒêƒÉng k√Ω ngay</a>
                </p>
                <div class="divider">ho·∫∑c</div>
                <button class="btn-guest" onclick="playAsGuest()">üéÆ Ch∆°i Kh√¥ng C·∫ßn ƒêƒÉng Nh·∫≠p</button>
            </div>

            <!-- Register Form -->
            <div class="auth-form" id="registerForm" style="display:none;">
                <h2>ƒêƒÉng K√Ω</h2>
                <div class="form-group">
                    <label>üë§ T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="registerUsername" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p...">
                </div>
                <div class="form-group">
                    <label>üìß Email</label>
                    <input type="email" id="registerEmail" placeholder="Nh·∫≠p email...">
                </div>
                <div class="form-group">
                    <label>üîí M·∫≠t kh·∫©u</label>
                    <input type="password" id="registerPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
                </div>
                <div class="form-group">
                    <label>üîí X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                    <input type="password" id="registerConfirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u...">
                </div>
                <button class="btn-primary" onclick="handleRegister()">ƒêƒÉng K√Ω</button>
                <p class="auth-switch">
                    ƒê√£ c√≥ t√†i kho·∫£n? 
                    <a href="#" onclick="showLogin(); return false;">ƒêƒÉng nh·∫≠p</a>
                </p>
            </div>

            <div class="message" id="authMessage"></div>
        </div>

        <!-- Mode Selection -->
        <div class="mode-selection" id="modeSelection" style="display:none;">
            <div class="user-info">
                <span id="welcomeUser">üë§ Kh√°ch</span>
                <button class="btn-logout" onclick="logout()">ƒêƒÉng xu·∫•t</button>
            </div>
            <h1>üéÆ C·ªù Vua</h1>
            <p>Ch·ªçn ch·∫ø ƒë·ªô ch∆°i</p>
            <div class="mode-buttons">
                <button class="mode-btn" onclick="selectMode('local')">
                    <span class="mode-icon">üë•</span>
                    <h3>Ch∆°i Online</h3>
                </button>
                <button class="mode-btn" onclick="selectMode('ai')">
                    <span class="mode-icon">ü§ñ</span>
                    <h3>Ch∆°i v·ªõi M√°y</h3>
                </button>
                <button class="mode-btn" onclick="selectMode('online')">
                    <span class="mode-icon">üåê</span>
                    <h3>T·∫°o Ph√≤ng</h3>
                </button>
            </div>
        </div>

        <!-- AI Game Container -->
        <div class="ai-game-container" id="aiGameContainer">
            <div class="board-header">
                <h2>C·ªù Vua - Ch∆°i v·ªõi M√°y AI</h2>
                <button class="btn-back" onclick="backToMenu()">‚Üê Quay l·∫°i</button>
            </div>

            <!-- Modal ch·ªçn m√†u -->
            <div class="modal" id="chooseColorModal">
                <div class="modal-content">
                    <h3>Ch·ªçn m√†u qu√¢n c·ªù</h3>
                    <div class="color-choices">
                        <button class="color-btn" id="chooseWhite">
                            <span style="font-size: 60px;">‚ôî</span>
                            <p>Ch∆°i Tr·∫Øng</p>
                        </button>
                        <button class="color-btn" id="chooseBlack">
                            <span style="font-size: 60px;">‚ôö</span>
                            <p>Ch∆°i ƒêen</p>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal ch·ªçn c·∫•p ƒë·ªô -->
            <div class="modal" id="level-selection-modal">
                <div class="modal-content">
                    <h3>Ch·ªçn ƒë·ªô kh√≥</h3>
                    <div class="level-buttons">
                        <button class="level-btn" data-level="1">D·ªÖ</button>
                        <button class="level-btn" data-level="2">Trung B√¨nh</button>
                        <button class="level-btn" data-level="3">Kh√≥</button>
                        <button class="level-btn" data-level="4">R·∫•t Kh√≥</button>
                    </div>
                </div>
            </div>

            <div class="game-info-ai">
                <div class="info-section">
                    <div class="captured-pieces">
                        <label>‚ö™ Qu√¢n tr·∫Øng m·∫•t:</label>
                        <div id="captured-white"></div>
                    </div>
                    <div class="ai-settings">
                        <label>ƒê·ªô kh√≥ AI:</label>
                        <select id="ai-level">
                            <option value="1">D·ªÖ</option>
                            <option value="2" selected>Trung B√¨nh</option>
                            <option value="3">Kh√≥</option>
                            <option value="4">R·∫•t Kh√≥</option>
                        </select>
                    </div>
                    <div class="captured-pieces">
                        <label>‚ö´ Qu√¢n ƒëen m·∫•t:</label>
                        <div id="captured-black"></div>
                    </div>
                </div>
            </div>

            <div class="game-status-ai">
                <div class="status-item">
                    <span id="game-status"></span>
                </div>
                <div class="status-item">
                    <label>‚è±Ô∏è Th·ªùi gian</label>
                    <span id="timer-display-ai">05:00</span>
                </div>
            </div>

            <div class="chessboard" id="chessboard-ai"></div>

            <div class="message-box" id="message-ai"></div>

            <div class="controls">
                <button class="btn-control" id="btn-restart">üîÑ Ch∆°i L·∫°i</button>
                <button class="btn-control" id="btn-undo">‚Ü∂ ƒêi L·∫°i</button>
                <button class="btn-control" id="btn-resign">üè≥Ô∏è ƒê·∫ßu H√†ng</button>
                <button class="btn-control" id="btn-rules"> Lu·∫≠t</button>
            </div>

            <div class="timer-controls">
                <button class="btn-time" id="btn-time-start">‚ñ∂Ô∏è</button>
                <button class="btn-time" id="btn-time-pause">‚è∏Ô∏è</button>
                <button class="btn-time" id="btn-time-reset">‚èπÔ∏è</button>
                <button class="btn-time" id="btn-time-up">‚¨ÜÔ∏è</button>
                <button class="btn-time" id="btn-time-down">‚¨áÔ∏è</button>
                <label style="margin-left: 10px;">
                    <input type="checkbox" id="toggle-timer" checked> B·∫≠t ƒë·ªìng h·ªì
                </label>
                <label style="margin-left: 10px;">
                    <input type="checkbox" id="toggle-hint"> G·ª£i √Ω n∆∞·ªõc ƒëi
                </label>
            </div>
        </div>

        <!-- Modal Phong C·∫•p AI -->
        <div class="modal" id="promotion-modal-ai">
            <div class="modal-content">
                <h3>Ch·ªçn qu√¢n phong c·∫•p</h3>
                <div class="promotion-choices">
                    <button class="promotion-btn" id="promote-queen">‚ôï<br>H·∫≠u</button>
                    <button class="promotion-btn" id="promote-rook">‚ôñ<br>Xe</button>
                    <button class="promotion-btn" id="promote-bishop">‚ôó<br>T∆∞·ª£ng</button>
                    <button class="promotion-btn" id="promote-knight">‚ôò<br>M√£</button>
                </div>
            </div>
        </div>

        <!-- Modal ƒê·∫ßu H√†ng -->
        <div class="modal" id="resign-modal">
            <div class="modal-content">
                <h3>üè≥Ô∏è X√°c nh·∫≠n ƒë·∫ßu h√†ng</h3>
                <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ch·ªãu thua?</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn-control" id="cancel-resign-btn" style="background: #6c757d;">‚úã ƒê√°nh ti·∫øp</button>
                    <button class="btn-control" id="confirm-resign-btn" style="background: #dc3545;">üè≥Ô∏è Ch·ªãu thua</button>
                </div>
            </div>
        </div>

        <!-- Modal Ch∆°i L·∫°i -->
        <div class="modal" id="restart-modal">
            <div class="modal-content">
                <h3>üîÑ X√°c nh·∫≠n ch∆°i l·∫°i</h3>
                <p>B·∫°n c√≥ mu·ªën b·∫Øt ƒë·∫ßu v√°n c·ªù m·ªõi?</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn-control" id="cancel-restart-btn" style="background: #6c757d;">H·ªßy</button>
                    <button class="btn-control" id="confirm-restart-btn" style="background: #28a745;">ƒê·ªìng √Ω</button>
                </div>
            </div>
        </div>

        <!-- Modal K·∫øt Th√∫c Game -->
        <div class="modal" id="game-over-modal">
            <div class="modal-content">
                <h2 id="game-over-title">K·∫æT TH√öC</h2>
                <p id="game-over-message"></p>
                <button class="btn-control" id="btn-gameover-restart" style="background: #28a745; margin-top: 20px;">üîÑ Ch∆°i v√°n m·ªõi</button>
            </div>
        </div>

        <!-- Modal Lu·∫≠t Ch∆°i -->
        <div class="modal" id="rules-modal">
            <div class="modal-content" style="max-width: 500px;">
                <h3>Lu·∫≠t Ch∆°i C·ªù Vua</h3>
                <button class="close-btn" style="position: absolute; top: 10px; right: 10px; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">‚úñ</button>
                <div style="text-align: left; padding: 20px;">
                    <h4>M·ª•c ti√™u:</h4>
                    <p>Chi·∫øu b√≠ Vua ƒë·ªëi ph∆∞∆°ng</p>
                    <h4>C√°ch di chuy·ªÉn:</h4>
                    <ul>
                        <li>‚ôô T·ªët: ƒêi 1 √¥ v·ªÅ ph√≠a tr∆∞·ªõc (l·∫ßn ƒë·∫ßu c√≥ th·ªÉ ƒëi 2 √¥)</li>
                        <li>‚ôñ Xe: ƒêi th·∫≥ng theo h√†ng ngang/d·ªçc</li>
                        <li>‚ôò M√£: ƒêi ch·ªØ L (2 √¥ + 1 √¥ vu√¥ng g√≥c)</li>
                        <li>‚ôó T∆∞·ª£ng: ƒêi ch√©o kh√¥ng gi·ªõi h·∫°n</li>
                        <li>‚ôï H·∫≠u: K·∫øt h·ª£p Xe + T∆∞·ª£ng</li>
                        <li>‚ôî Vua: ƒêi 1 √¥ theo m·ªçi h∆∞·ªõng</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Local Game Container -->
        <div class="local-game-container" id="localGameContainer" style="display:none;">
            <div class="board-header">
                <h2> C·ªù Vua - Ch∆°i v·ªõi Ng∆∞·ªùi</h2>
                <button class="btn-back" onclick="backToMenu()">‚Üê Quay l·∫°i</button>
            </div>

            <div class="game-status-local">
                <div class="status-item">
                    <label>L∆∞·ª£t ch∆°i</label>
                    <span id="game-status-local">‚ôî Tr·∫Øng</span>
                </div>
                <div class="status-item">
                    <label> Th·ªùi gian</label>
                    <span id="timer-display">05:00</span>
                </div>
            </div>

            <div class="chessboard" id="chessboard-local"></div>

            <div class="message-box" id="message-local"></div>

            <div class="controls">
                <button class="btn-control" onclick="resignGame()">üè≥Ô∏è ƒê·∫ßu H√†ng</button>
            </div>
        </div>

        <!-- Login Panel -->
        <div class="login-panel" id="loginPanel" style="display:none;">
            <h2>üéÆ C·ªù Vua Online</h2>
            
            <div class="user-welcome">
                <p>Xin ch√†o, <strong id="onlinePlayerName">Ng∆∞·ªùi ch∆°i</strong>!</p>
            </div>

            <div class="room-id-display" id="roomIdDisplay" style="display:none;">
                <label>üìã ID Ph√≤ng c·ªßa b·∫°n:</label>
                <div class="room-id-box">
                    <span id="displayRoomId">room_xxxxx</span>
                    <button class="btn-copy" onclick="copyRoomId()">üìã Copy</button>
                </div>
                <p class="copy-hint">Chia s·∫ª ID n√†y cho b·∫°n b√® ƒë·ªÉ v√†o ph√≤ng!</p>
            </div>

            <div class="form-group" id="roomInputGroup">
                <label for="roomId">ID Ph√≤ng:</label>
                <input type="text" id="roomId" placeholder="Nh·∫≠p ID ph√≤ng ƒë·ªÉ v√†o..." maxlength="20">
            </div>

            <div class="online-buttons" id="onlineButtons">
                <button class="btn btn-create" onclick="createRoom()">üÜï T·∫°o Ph√≤ng M·ªõi</button>
                <button class="btn btn-join" onclick="joinRoom()">üö™ V√†o Ph√≤ng</button>
            </div>

            <div class="error-message" id="loginError"></div>
            <div class="success-message" id="loginSuccess"></div>

            <div class="game-info">
                üí° <strong>H∆∞·ªõng d·∫´n:</strong>
                <br>‚Ä¢ <strong>T·∫°o ph√≤ng:</strong> B·∫•m "T·∫°o Ph√≤ng M·ªõi" ‚Üí Copy ID ‚Üí G·ª≠i b·∫°n b√®
                <br>‚Ä¢ <strong>V√†o ph√≤ng:</strong> Nh·∫≠p ID ph√≤ng ‚Üí B·∫•m "V√†o Ph√≤ng"
                <br>‚Ä¢ Ng∆∞·ªùi th·ª© nh·∫•t l√† Tr·∫Øng, ng∆∞·ªùi th·ª© hai l√† ƒêen
            </div>
            
            <button class="btn-back" onclick="backToMenu()" style="margin-top: 15px;">‚Üê Quay l·∫°i ch·ªçn ch·∫ø ƒë·ªô</button>
        </div>

        <!-- Game Board -->
        <div class="game-board-container" id="gameContainer">
            <div class="board-header">
                <h2>üéÆ Tr√≤ Ch∆°i C·ªù Vua</h2>
                <div class="room-info-banner">
                    <span id="gameTitle">Ph√≤ng: <strong id="currentRoomDisplay">---</strong></span>
                    <button class="btn-copy-small" onclick="copyCurrentRoomId()">üìã</button>
                </div>
            </div>

            <div class="game-status">
                <div class="status-item" id="whiteStatus">
                    <label>Ng∆∞·ªùi Tr·∫Øng</label>
                    <span id="whiteName">Ch·ªù...</span>
                </div>
                <div class="status-item active" id="turnStatus">
                    <label>L∆∞·ª£t Ch∆°i</label>
                    <span id="currentTurn">Tr·∫Øng</span>
                </div>
                <div class="status-item" id="blackStatus">
                    <label>Ng∆∞·ªùi ƒêen</label>
                    <span id="blackName">Ch·ªù...</span>
                </div>
            </div>

            <div class="chessboard" id="chessboard"></div>

            <div class="error-message" id="gameError"></div>
            <div class="success-message" id="gameSuccess"></div>

            <div class="controls">
                <button class="btn-control" id="resetBtn" onclick="resetGame()">Ch∆°i L·∫°i</button>
                <button class="btn-control" id="leaveBtn" onclick="leaveGame()">R·ªùi Ph√≤ng</button>
            </div>

            <div class="moves-history" id="movesHistory">
                <h4> L·ªãch S·ª≠ N∆∞·ªõc ƒêi</h4>
                <div id="movesList"></div>
            </div>
        </div>

        <!-- Promotion Modal for Local Game -->
        <div class="modal" id="promotion-modal-local">
            <div class="modal-content">
                <h3>Ch·ªçn qu√¢n phong c·∫•p</h3>
                <div class="promotion-choices">
                    <button class="promotion-btn" onclick="promotePieceLocal('queen')">‚ôï<br>H·∫≠u</button>
                    <button class="promotion-btn" onclick="promotePieceLocal('rook')">‚ôñ<br>Xe</button>
                    <button class="promotion-btn" onclick="promotePieceLocal('bishop')">‚ôó<br>T∆∞·ª£ng</button>
                    <button class="promotion-btn" onclick="promotePieceLocal('knight')">‚ôò<br>M√£</button>
                </div>
            </div>
        </div>

        <!-- Promotion Modal for Online Game -->
        <div class="modal" id="promotion-modal-online">
            <div class="modal-content">
                <h3>Ch·ªçn qu√¢n phong c·∫•p</h3>
                <div class="promotion-choices">
                    <button class="promotion-btn" onclick="promoteOnline('queen')">‚ôï<br>H·∫≠u</button>
                    <button class="promotion-btn" onclick="promoteOnline('rook')">‚ôñ<br>Xe</button>
                    <button class="promotion-btn" onclick="promoteOnline('bishop')">‚ôó<br>T∆∞·ª£ng</button>
                    <button class="promotion-btn" onclick="promoteOnline('knight')">‚ôò<br>M√£</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
